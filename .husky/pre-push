echo "pre-push: running full test suite"

# Run unit tests - must pass
npm test || exit 1

# Run E2E tests - may exit 1 due to Playwright webServer cleanup issue
# even when all tests pass. Check output for actual failures.
npm run test:e2e 2>&1 | tee /tmp/e2e-output.log
E2E_EXIT=$?

if [ $E2E_EXIT -ne 0 ]; then
  # Check if tests actually passed despite non-zero exit
  if grep -q "passed" /tmp/e2e-output.log && ! grep -q "failed" /tmp/e2e-output.log; then
    echo "✅ E2E tests passed (ignoring webServer cleanup exit code)"
    exit 0
  else
    echo "❌ E2E tests failed"
    exit 1
  fi
fi
